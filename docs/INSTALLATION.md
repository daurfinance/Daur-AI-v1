# Установка и быстрая проверка Daur-AI

Этот документ описывает пошаговую установку Daur-AI в виртуальном окружении Python, настройку прав для контроллера ввода и запуск демонстрации контроллера.

Важно: для полнофункционального контроллера ввода (`pyautogui`, `pyperclip`) потребуется дать приложению права на управление (особенно на macOS). См. раздел "Платформенные примечания".

## 1. Создание виртуального окружения и установка

Откройте терминал в корне репозитория и выполните:

```bash
python3 -m venv .venv
source .venv/bin/activate
python -m pip install --upgrade pip setuptools wheel
# Установить пакет в editable режиме (читает requirements.txt)
pip install -e .
```

Если вы хотите установить только минимальный набор (без AI-моделей), используйте extras `gui`:

```bash
pip install -e .[gui]
```

Для полной установки с AI-зависимостями (может занять значительное время и требовать CUDA/специфичных wheel'ов):

```bash
pip install -e .[full]
```

## 2. Проверка контроллера ввода (безопасно)

Запустите демон, который попросит подтверждение перед выполнением действий:

```bash
source .venv/bin/activate
python examples/demo_input.py
```

Демон спросит подтверждение; при согласии выполнит ввод текста и создаст скриншот в рабочей директории.

## 3. Разрешения и платформа

- macOS:
  - Откройте System Settings -> Privacy & Security -> Accessibility и добавьте терминал (и/или приложение, которое будет запускать агента) в список разрешённых приложений на управление компьютером.
  - Также может потребоваться разрешение Screen Recording для снятия скриншотов: System Settings -> Privacy & Security -> Screen Recording.

- Linux (X11):
  - Убедитесь, что установлен `python-xlib` (в `requirements.txt` отмечено условием для Linux).
  - В средах Wayland pyautogui может работать нестабильно; рассмотрите запуск на X11 или использование других средств автоматизации (xdotool, etc.).

- Windows:
  - Для работы с окнами и GUI может потребоваться запуск с правами пользователя; убедитесь, что установлены `pywin32` и `pygetwindow`.

## 4. Тесты

Запустите unit-тесты (pytest):

```bash
source .venv/bin/activate
pytest -q
```

Примечание: тест `tests/test_input_controller.py` пропустится, если `pyautogui` не установлен в окружении CI. В локальной среде тест фактически выполняет ввод — запускайте с осторожностью.

## 5. Частые проблемы и решения

- `pyautogui` не управляет окнами/клавиатурой на Wayland: используйте X11 или установите дополнительные инструменты.
- На macOS при отсутствии прав приложение не сможет вводить/кликать — проверьте Accessibility и Screen Recording.
- Если установка `torch` или `onnxruntime` вызывает ошибки, попробуйте установить их отдельно согласно инструкции на официальных сайтах (возможно, потребуется специфичный wheel для вашей платформы).

## 6. Что дальше

После успешной установки и тестирования контроллера можно:
- Запустить агента полнофункционально (web API, web-ui, Telegram-бот) — я помогу подготовить команды запуска.
- Добавить мок-режим для тестов CI, чтобы избежать реального ввода/кликов в автоматической среде.
